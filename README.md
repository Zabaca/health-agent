# Medical Record Release Form

A Next.js web app that allows patients to register, log in, and create medical record release & request forms. Each form captures patient info, unlimited healthcare provider entries with record request details, and an authorization section with a drawn signature.

## Tech Stack

- **Framework**: Next.js 14 (App Router, TypeScript)
- **UI**: Mantine v7
- **Database**: SQLite via Drizzle ORM + libSQL (`@libsql/client`)
- **Auth**: NextAuth.js v5 (credentials — email/password, Edge-compatible split config)
- **Forms**: react-hook-form + zod
- **Signature**: react-signature-canvas
- **Linter**: oxlint

## Prerequisites

- [Bun](https://bun.sh) v1.0 or higher

## Getting Started

### 1. Install dependencies

```bash
bun install
```

### 2. Configure environment variables

Copy the example below into a `.env` file at the project root:

```env
DATABASE_URL="file:./dev.db"
AUTH_SECRET="replace-with-a-random-string-at-least-32-chars"
NEXTAUTH_URL="http://localhost:3000"
```

Generate a secure `AUTH_SECRET`:

```bash
openssl rand -base64 32
```

### 3. Set up the database

```bash
bun db:migrate
```

Creates the SQLite database at `./dev.db` and applies all Drizzle migrations.

### 4. Start the development server

```bash
bun dev
```

Open [http://localhost:3000](http://localhost:3000) in your browser.

---

## Usage

1. **Register** at `/register` — creates a new account
2. **Log in** at `/login`
3. **Dashboard** (`/dashboard`) — lists all your releases with view and delete actions
4. **New Release** (`/releases/new`) — fill out patient info, add one or more healthcare providers, draw a signature, and submit
5. **View Release** (`/releases/[id]`) — read-only snapshot of a submitted release; releases cannot be edited after creation

---

## Available Scripts

| Command | Description |
|---------|-------------|
| `bun dev` | Start development server at http://localhost:3000 |
| `bun build` | Build for production |
| `bun start` | Start production server (requires build first) |
| `bun lint` | Run oxlint on all source files |
| `bun type-check` | Run TypeScript type checking |
| `bun db:generate` | Generate a new Drizzle migration from schema changes |
| `bun db:migrate` | Apply pending database migrations |

---

## Project Structure

```
src/
├── app/
│   ├── (auth)/login         # Login page
│   ├── (auth)/register      # Register page
│   ├── (protected)/
│   │   ├── dashboard        # Release list
│   │   └── releases/        # New release & read-only view pages
│   └── api/                 # API routes (auth, register, releases, upload)
├── components/
│   ├── auth/                # LoginForm, RegisterForm
│   ├── dashboard/           # ReleaseList table
│   ├── layout/              # AppShell, Sidebar
│   ├── release-form/        # Form sections and field components
│   └── release-view/        # Read-only view components (DeleteReleaseButton)
├── lib/
│   ├── db/                  # Drizzle client, schema, and inferred DB types
│   └── schemas/             # Zod schemas (single source of truth for form types)
└── types/                   # Re-export barrel for shared types
drizzle/                     # SQL migrations (auto-generated by drizzle-kit)
dev.db                       # SQLite database file (auto-generated, git-ignored)
public/
└── uploads/                 # Uploaded files (signature PNGs, membership card photos)
```
